const fs = require('fs');
const tasksFile = 'tasks.json';

// Load tasks from file
const loadTasks = () => {
  try {
    const dataBuffer = fs.readFileSync(tasksFile);
    const dataJSON = dataBuffer.toString();
    return JSON.parse(dataJSON);
  } catch {
    return [];
  }
};

// Save tasks to file
const saveTasks = (tasks) => {
  const dataJSON = JSON.stringify(tasks, null, 2);
  fs.writeFileSync(tasksFile, dataJSON);
};

// Add a task
const addTask = (description) => {
  const tasks = loadTasks();
  tasks.push({ id: tasks.length + 1, description, completed: false });
  saveTasks(tasks);
  console.log('Task added:', description);
};

// List all tasks
const listTasks = () => {
  const tasks = loadTasks();
  tasks.forEach(task => {
    console.log(`${task.id}. [${task.completed ? 'x' : ' '}] ${task.description}`);
  });
};

// Mark a task as completed
const completeTask = (id) => {
  const tasks = loadTasks();
  const task = tasks.find(t => t.id === id);
  if (task) {
    task.completed = true;
    saveTasks(tasks);
    console.log('Task completed:', task.description);
  } else {
    console.log('Task not found');
  }
};

// Remove a task
const removeTask = (id) => {
  let tasks = loadTasks();
  tasks = tasks.filter(t => t.id !== id);
  saveTasks(tasks);
  console.log('Task removed:', id);
};
